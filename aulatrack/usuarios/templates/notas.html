{% extends "base.html" %}
{% load static %}

{% block title %}AulaTrack - Notas{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/notas.css' %}">
{% endblock %}

{% block content %}
<h2 class="sectionTitle">
  Notas - {{ curso.año }} {{ curso.nombre }} ({{ asignatura.nombre }})
</h2>
<p class="hint">Calificaciones por asignatura</p>
<div class="divider"></div>

<div class="grades-scroll">
  <table class="grades-table">
    <thead>
      <tr>
        <th>Alumno</th>
        <th>Evaluaciones</th>
        <th>Promedio</th>
      </tr>
    </thead>
    <tbody>
      {% for alumno, data in notas_por_alumno.items %}
      <tr>
        <td>{{ alumno.nombres }} {{ alumno.apellidos }}</td>
        <td>
          {% for nota in data.notas %}
            {{ nota.evaluacion }}: <strong>{{ nota.valor }}</strong><br>
          {% empty %}
            <i>Sin notas</i>
          {% endfor %}
        </td>
        <td>
          {% if data.promedio %}
            {{ data.promedio }}
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="3">No hay alumnos en este curso.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="divider" style="margin: 30px 0;"></div>

<!-- Formulario para agregar nueva evaluación -->
<h3>Agregar nueva evaluación</h3>
<form method="post">
  {% csrf_token %}
  <div style="margin-bottom: 10px;">
    <label>Nombre de la evaluación:</label>
    <input type="text" name="evaluacion" placeholder="Ej: Prueba 3" required>
  </div>

  <table class="grades-table">
    <thead>
      <tr>
        <th>Alumno</th>
        <th>Nota</th>
      </tr>
    </thead>
    <tbody>
      {% for alumno in alumnos %}
      <tr>
        <td>{{ alumno.nombres }} {{ alumno.apellidos }}</td>
        <td><input type="number" step="0.1" min="1" max="7" name="nota_{{ alumno.id }}" placeholder="-" /></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <button type="submit" class="topCta">Guardar evaluación</button>
</form>
{% endblock %}
