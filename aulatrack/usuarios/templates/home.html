{% extends "base.html" %}
{% load static %}

{% block title %}AulaTrack - Home{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}

{% block content %}
 

<div class="filter-bar">
  <form method="get">
    <label for="ordenar">Ordenar por:</label>
    <select name="ordenar" id="ordenar" onchange="this.form.submit()">
      <option value="basico_asc" {% if request.GET.ordenar == 'basico_asc' or not request.GET.ordenar %}selected{% endif %}>
        Básico (1° → 8°)
      </option>
      <option value="basico_desc" {% if request.GET.ordenar == 'basico_desc' %}selected{% endif %}>
        Básico (8° → 1°)
      </option>
      <option value="nombre_asc" {% if request.GET.ordenar == 'nombre_asc' %}selected{% endif %}>
        Nombre (A → Z)
      </option>
    </select>
  </form>
  <a class="topCta">+ Nuevo curso (Solo Admin)</a>
</div>

<!-- ===== Tus cursos (docente) ===== -->
<div class="courses">
  {% if cursos_docente %}
    {% for c in cursos_docente %}
      <article class="courseCard {% if c.profesor_jefe_id == request.user.id %}is-mi-curso{% endif %}" tabindex="0">
        <span class="badge">{{ c.año }}</span>

        {# Distintivo si el usuario es profesor jefe de este curso #}
        {% if c.profesor_jefe_id == request.user.id %}
          <span class="badge-mi-curso" aria-label="Eres profesor jefe de este curso">Mi curso</span>
        {% endif %}

        <div class="title">{{ c.nombre }}</div>
        <div class="meta">Aula {{ c.sala }}</div>

        <div class="meta">Profesor Jefe:
          {% if c.profesor_jefe %}
            {{ c.profesor_jefe.username }}{% if c.profesor_jefe_id == request.user.id %} (tú){% endif %}
          {% else %}
            Sin asignar
          {% endif %}
        </div>

        <div class="actions">
          <a href="{% url 'curso' c.id %}" class="btn btn-primary">Entrar</a>
        </div>
      </article>
    {% endfor %}
  {% elif user.perfil.role == 'docente' %}
    <p class="muted">No tienes cursos asignados.</p>
  {% endif %}
</div>

{% if user.perfil.role == 'utp' %}
  <div style="margin-top: 8px;">
    <div class="sectionTitle">Todos los cursos</div>
    <div class="hint">Vista de UTP: gestión de todos los cursos</div>
  </div>

  <div class="courses">
    {% if cursos_todos %}
      {% for curso in cursos_todos %}
        <article class="courseCard" tabindex="0">
          <span class="badge">{{ curso.año }}</span>

          <div class="title">{{ curso.nombre }}</div>
          <div class="meta">Aula {{ curso.sala }}</div>
          <div class="meta">Profesor Jefe:
            {% if curso.profesor_jefe %}
              {{ curso.profesor_jefe.username }}
            {% else %}
              Sin asignar
            {% endif %}
          </div>

          <div class="actions">
            <a href="{% url 'curso' curso.id %}" class="btn btn-primary">Entrar</a>
            <a href="{% url 'curso_editar' curso.id %}" class="btn btn-ghost">Editar</a>
            <a href="{% url 'curso_eliminar' curso.id %}" class="btn btn-danger">Eliminar</a>
          </div>
        </article>
      {% endfor %}
    {% else %}
      <p class="muted">No hay cursos creados.</p>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
