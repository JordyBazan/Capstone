{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Informe Parcial - {{ alumno.nombres }} {{ alumno.apellidos }}</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 12px; margin: 40px; color: #000; }
    .header-box { border: 1px solid #000; padding: 10px; margin-bottom: 25px; }
    .header-box p { margin: 4px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    th, td { border: 1px solid #000; padding: 4px; text-align: center; }
    th { background: #f2f2f2; font-weight: bold; }
    td.left { text-align: left; font-weight: bold; }
    .muted { color: #555; font-size: 11px; }
    .footer { margin-top: 40px; font-size: 11px; text-align: center; }
    .green { color: green; font-weight: bold; }
    .red { color: red; font-weight: bold; }
    .signatures { margin-top: 80px; display: flex; justify-content: space-around; }
    .signature-box { width: 40%; text-align: center; border-top: 1px solid #000; padding-top: 5px; }
  </style>
</head>
<body>

  <!-- Encabezado oficial -->
  <div class="header-box">
    <p style="text-align:justify;">
      <b>Reconocido oficialmente por el Ministerio de Educación de la República de Chile,</b> 
      según (Ley – Decreto Supremo – Resolución Exenta de Educación) N° <b>5313 de 1981</b>, 
      se otorga el presente Informe de Notas Parciales a:
    </p>

    <p><b>DON (A):</b> {{ alumno.nombres }} {{ alumno.apellidos }} &nbsp;&nbsp; 
      <b>RUT:</b> {{ alumno.rut }}</p>

    <p>Del <b>{{ curso.nombre }}</b> ha obtenido las siguientes Notas Semestrales en el: 
      <b>PRIMER SEMESTRE {{ generado|date:"Y" }}</b>.</p>

    <p><b>Fecha de Entrega:</b> {{ generado|date:"d 'de' F 'de' Y" }}</p>
  </div>

  <!-- Tabla de notas -->
  <table>
    <thead>
      <tr>
        <th style="width:35%">SUBSECTORES Y/O ASIGNATURA</th>
        {% for c in columnas_notas %}
          <th>N{{ c }}</th>
        {% endfor %}
        <th>PROM</th>
      </tr>
    </thead>
    <tbody>
      {% for a in asignaturas_data %}
        <tr>
          <td class="left">{{ a.nombre|upper }}</td>

          {# Notas reales con color según valor #}
          {% for n in a.notas %}
            <td class="{% if n < 4 %}red{% else %}green{% endif %}">{{ n|floatformat:1 }}</td>
          {% endfor %}

          {# Rellenar celdas vacías si hay menos de 11 notas #}
          {% for i in columnas_notas %}
            {% if forloop.counter > a.notas|length %}
              <td></td>
            {% endif %}
          {% endfor %}

          <td><b>{{ a.promedio|floatformat:1 }}</b></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Promedio final del alumno -->
  <p style="margin-top:10px;"><b>PROMEDIO GENERAL DEL ALUMNO:</b> {{ promedio_general|floatformat:1 }}</p>

  <!-- Asistencia -->
  <p><b>ASISTENCIA GENERAL:</b> {{ porcentaje_asistencia }}%</p>

  <!-- Anotaciones -->
  <div style="margin-top:30px;">
    <h3 style="text-transform:uppercase;">Anotaciones</h3>
    {% if anotaciones %}
      <table>
        <thead>
          <tr>
            <th style="width:20%;">Fecha</th>
            <th>Detalle</th>
            <th style="width:25%;">Profesor</th>
          </tr>
        </thead>
        <tbody>
          {% for a in anotaciones %}
            <tr>
              <td>{{ a.fecha|date:"d/m/Y" }}</td>
              <td style="text-align:left;">{{ a.texto }}</td>
              <td>{{ a.profesor.first_name }} {{ a.profesor.last_name }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No existen anotaciones registradas para este alumno.</p>
    {% endif %}
  </div>

  <!-- Firmas -->
  <div class="signatures">
    <div class="signature-box">
      Firma Apoderado(a)
    </div>
    <div class="signature-box">
      Firma Docente / UTP
    </div>
  </div>

  <!-- Pie -->
  <div class="footer">
    Documento generado automáticamente por el sistema "AulaTrack" el {{ generado|date:"d/m/Y H:i" }}.
  </div>

</body>
</html>
prueba