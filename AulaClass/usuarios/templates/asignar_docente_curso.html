{% extends 'base.html' %}
{% load static %}

{% block title %}Asignar Docente a Curso - AulaClass{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/asignar_docente_curso.css' %}">
{% endblock %}

{% block content %}

<div class="dashboard-header">
    <h1>Asignación de Docentes</h1>
    <p class="hint">Vincula profesores a cursos completos para que puedan gestionar todas sus asignaturas.</p>
</div>

<form method="post" class="form-card fade-in">
    {% csrf_token %}
    <h2>Nueva Asignación</h2>
    
    <div class="field-row">
        <div class="field">
            <label for="{{ form.docente.id_for_label }}">Seleccionar Docente:</label>
            {{ form.docente }}
        </div>
        <div class="field">
            <label for="{{ form.curso.id_for_label }}">Seleccionar Curso:</label>
            {{ form.curso }}
        </div>
        <button type="submit" class="btn-prim">Asignar Docente</button>
    </div>
</form>

<div class="asignaciones fade-in">
    <h2>Asignaciones Vigentes</h2>

    {% if asignaciones %}
        <div class="table-container">
            <table class="styled-table">
                <thead>
                    <tr>
                        <th>Docente</th>
                        <th>Curso Asignado</th>
                        <th>Asignaturas Relacionadas</th>
                        <th style="text-align: right;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for asignacion in asignaciones %}
                    <tr>
                        <td>
                            <strong>{{ asignacion.docente.get_full_name|default:asignacion.docente.username }}</strong>
                        </td>
                        <td>
                            <span style="font-weight:600;">{{ asignacion.curso.nombre }}</span>
                        </td>
                        <td>
                            {% with materias=asignacion.curso.asignaturas.all %}
                                {% if materias %}
                                    {% for asig in materias %}
                                        <span class="chip">{{ asig.nombre }}</span>
                                    {% endfor %}
                                {% else %}
                                    <span class="muted">Sin asignaturas registradas</span>
                                {% endif %}
                            {% endwith %}
                        </td>
                        <td class="actions">
                            <a href="{% url 'usuarios:curso_editar' asignacion.curso.id %}" class="btn small">Ver Curso</a>
                            
                            <form method="post" 
                                  action="{% url 'usuarios:eliminar_asignacion' asignacion.id %}" 
                                  class="js-delete-form" 
                                  data-confirm="¿Eliminar la asignación de {{ asignacion.docente }} al curso {{ asignacion.curso }}?">
                                {% csrf_token %}
                                <button type="submit" class="btn small danger">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            <p>No hay docentes asignados a cursos todavía.</p>
        </div>
    {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const forms = document.querySelectorAll(".js-delete-form");
    forms.forEach(form => {
        form.addEventListener("submit", function(e) {
            const msg = this.getAttribute("data-confirm") || "¿Estás seguro?";
            if (!confirm(msg)) {
                e.preventDefault();
            }
        });
    });
});
</script>

{% endblock %}