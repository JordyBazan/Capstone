{% extends 'base.html' %}
{% load static %}

{% block title %}
    {% if modo_password %}Cambiar Contraseña{% else %}Editar Usuario{% endif %} - AulaClass
{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/editar_usuario.css' %}">
{% endblock %}

{% block content %}

<div class="edit-wrapper">
    <div class="card-edit">
        
        <h1>
          {% if modo_password %}
             Cambiar contraseña
          {% else %}
             Editar Perfil de Usuario
          {% endif %}
        </h1>

        <form method="post">
          {% csrf_token %}

          {% if modo_password %}
            <div class="form-group">
                <label for="{{ form_pass.password1.id_for_label }}" class="form-label">Nueva contraseña</label>
                <input type="password" name="{{ form_pass.password1.name }}" 
                       id="{{ form_pass.password1.id_for_label }}" class="input-aula" required>
                
                {% if form_pass.password1.errors %}
                    <div class="errorlist">{{ form_pass.password1.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="{{ form_pass.password2.id_for_label }}" class="form-label">Confirmar contraseña</label>
                <input type="password" name="{{ form_pass.password2.name }}" 
                       id="{{ form_pass.password2.id_for_label }}" class="input-aula" required>
                
                {% if form_pass.password2.errors %}
                    <div class="errorlist">{{ form_pass.password2.errors }}</div>
                {% endif %}
            </div>

            <div class="actions">
                <button type="submit" class="btn-save">Actualizar contraseña</button>
                <a href="{% url 'usuarios:gestion_usuario' %}" class="btn-cancel">Cancelar</a>
            </div>

          {% else %}
            <div class="form-group">
                <label for="id_username" class="form-label">Nombre de usuario (Login):</label>
                <input type="text" name="username" id="id_username" 
                       value="{{ usuario.username }}" class="input-aula" required>
            </div>

            <div class="form-group">
                <label for="id_rut" class="form-label">RUT:</label>
                <input type="text" name="rut" id="id_rut" 
                       value="{{ usuario.rut }}" class="input-aula" required>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label for="id_nombres" class="form-label">Nombres:</label>
                    <input type="text" name="nombres" id="id_nombres" 
                           value="{{ usuario.nombres }}" class="input-aula" required>
                </div>
                <div class="form-group">
                    <label for="id_apellidos" class="form-label">Apellidos:</label>
                    <input type="text" name="apellidos" id="id_apellidos" 
                           value="{{ usuario.apellidos }}" class="input-aula" required>
                </div>
            </div>

            <div class="form-group">
                <label for="id_email" class="form-label">Correo electrónico:</label>
                <input type="email" name="email" id="id_email" 
                       value="{{ usuario.email }}" class="input-aula" required>
            </div>

            <div class="form-group">
                <label for="id_role" class="form-label">Rol en el sistema:</label>
                <select name="role" id="id_role" class="input-aula">
                    {% for key, value in roles %}
                      <option value="{{ key }}" {% if usuario.role == key %}selected{% endif %}>
                        {{ value }}
                      </option>
                    {% endfor %}
                </select>
            </div>

            <div class="actions">
                <button type="submit" class="btn-save">Guardar cambios</button>
                <a href="{% url 'usuarios:gestion_usuario' %}" class="btn-cancel">Cancelar</a>
            </div>

          {% endif %}
        </form>
    </div>
</div>

{% endblock %}